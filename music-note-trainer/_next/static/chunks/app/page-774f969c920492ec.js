(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1057:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});var l=a(5155),n=a(2115);function s(){let[e,t]=(0,n.useState)("en"),a={en:{title:"Music Note Reading Trainer",trebleClef:"Treble Clef",bassClef:"Bass Clef",rangeSettings:"Set Note Range",closeRangeSettings:"Close Range Settings",currentRange:"Current Range",lowerLimit:"Lower Limit",upperLimit:"Upper Limit",example:"Example: C4, F5, etc. (Note name + Octave)",resetToDefault:"Reset to Default",apply:"Apply",correct:"Correct! ({note})",incorrect:"Incorrect. The answer is {note} ({fullNote})",keyboardShortcuts:"Keyboard shortcuts: C, D, E, F, G, A, B keys to answer, Space key for next note",score:"Score",nextNote:"Next Note",noteCount:"Number of Notes",currentNote:"Current Note: {current} of {total}"},ja:{title:"楽譜読み取りトレーニング",trebleClef:"ト音記号",bassClef:"ヘ音記号",rangeSettings:"音符範囲を設定",closeRangeSettings:"範囲設定を閉じる",currentRange:"現在の範囲",lowerLimit:"下限",upperLimit:"上限",example:"例: C4, F5 など（音名 + オクターブ）",resetToDefault:"デフォルトに戻す",apply:"適用",correct:"正解！ ({note})",incorrect:"不正解。正解は {note} です。({fullNote})",keyboardShortcuts:"キーボードショートカット: C, D, E, F, G, A, B キーで回答、スペースキーで次の音符",score:"スコア",nextNote:"次の音符",noteCount:"音符の数",currentNote:"現在の音符: {current} / {total}"}},s=function(t){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a[e][t]||t;return Object.keys(l).forEach(e=>{n=n.replace("{".concat(e,"}"),l[e])}),n},r=["C","D","E","F","G","A","B"],c={treble:{min:{name:"C",octave:3},max:{name:"B",octave:5}},bass:{min:{name:"C",octave:1},max:{name:"B",octave:3}}},[o,i]=(0,n.useState)(c),[m,u]=(0,n.useState)({treble:"C3",bass:"C1"}),[d,x]=(0,n.useState)({treble:"B5",bass:"B3"}),[b,h]=(0,n.useState)(!1),p={treble:[...r.map(e=>({name:e,octave:3})),...r.map(e=>({name:e,octave:4})),...r.map(e=>({name:e,octave:5})),...r.map(e=>({name:e,octave:6})),...r.map(e=>({name:e,octave:7})).filter(e=>"C"===e.name)],bass:[...r.map(e=>({name:e,octave:1})),...r.map(e=>({name:e,octave:2})),...r.map(e=>({name:e,octave:3})),...r.map(e=>({name:e,octave:4}))]},[f,g]=(0,n.useState)(4),[v,N]=(0,n.useState)(0),[j,w]=(0,n.useState)([]),[C,y]=(0,n.useState)([]),[S,k]=(0,n.useState)([]),[E,L]=(0,n.useState)(""),[M,R]=(0,n.useState)(0),[A,B]=(0,n.useState)(0),[D,F]=(0,n.useState)("treble"),[T,O]=(0,n.useState)(!1),[G,_]=(0,n.useState)({treble:{},bass:{}});(0,n.useEffect)(()=>{let e={treble:{},bass:{}};Object.keys(p).forEach(t=>{p[t].forEach(a=>{let l="".concat(a.name).concat(a.octave);e[t][l]=0})}),_(e)},[]),(0,n.useEffect)(()=>{if(j.length>0&&v<j.length){let e=j[v],t="".concat(e.name).concat(e.octave);_(e=>{if(void 0!==e[D][t]){let a={...e};return a[D]={...a[D]},a[D][t]=(a[D][t]||0)+1,a}return e})}},[j,v,D]);let I=e=>{if(!e||e.length<2)return null;let t=e[0].toUpperCase(),a=Number.parseInt(e.substring(1));return!r.includes(t)||isNaN(a)?null:{name:t,octave:a}},U=e=>"".concat(e.name).concat(e.octave),X=(e,t)=>e.octave!==t.octave?e.octave-t.octave:r.indexOf(e.name)-r.indexOf(t.name),K=(0,n.useCallback)(e=>{let t=o[D];return X(e,t.min)>=0&&0>=X(e,t.max)},[o,D]),P=(0,n.useCallback)(()=>p[D].filter(K),[D,K]),q=(0,n.useCallback)(()=>{let e=P();if(0===e.length)return p[D][Math.floor(Math.random()*p[D].length)];let t=G[D];if(!t||0===Object.keys(t).length){let t=Math.floor(Math.random()*e.length);return e[t]}let a=e.map(e=>{let a=t["".concat(e.name).concat(e.octave)]||0;return{note:e,weight:1/(a+1)}}),l=a.filter(e=>!S.length||!S.some(t=>e.note.name===t.name&&e.note.octave===t.octave)),n=l.length>0?l:a,s=Math.random()*n.reduce((e,t)=>e+t.weight,0);for(let e of n)if((s-=e.weight)<=0)return e.note;return n[0].note},[D,G,P,S]),z=(0,n.useCallback)(()=>{let e=[];for(let t=0;t<f;t++){let t;do t=q();while(e.some(e=>e.name===t.name&&e.octave===t.octave));e.push(t)}k([]),w(e),y(Array(f).fill("")),N(0),L(""),O(!1)},[q,f,D]);(0,n.useEffect)(()=>{0===j.length&&z()},[z,j.length]);let H=()=>{z()},J=()=>{v<f-1?(N(v+1),L(""),O(!1)):H()},Q=e=>{if(T)return;O(!0);let t=[...C];t[v]=e,y(t),B(A+1);let a=j[v];e===a.name?(L(s("correct",{note:$(a)})),R(M+1),setTimeout(()=>{J()},500)):(L(s("incorrect",{note:a.name,fullNote:$(a)})),O(!1))},V=e=>{e!==f&&(k([]),y([]),N(0),L(""),O(!1),R(0),B(0),g(e),setTimeout(()=>{let t=[];for(let a=0;a<e;a++){let e;do{let t=p[D].filter(e=>{let t=o[D];return X(e,t.min)>=0&&0>=X(e,t.max)}),a=Math.floor(Math.random()*t.length);e=t[a]}while(t.some(t=>t.name===e.name&&t.octave===e.octave));t.push(e)}w(t),y(Array(e).fill(""))},0))},W=e=>{e!==D&&(F(e),k([]),y([]),N(0),L(""),O(!1),R(0),B(0),setTimeout(()=>{let t=[];for(let a=0;a<f;a++){let a;do{let t=p[e].filter(t=>{let a=o[e];return X(t,a.min)>=0&&0>=X(t,a.max)}),l=Math.floor(Math.random()*t.length);a=t[l]}while(t.some(e=>e.name===a.name&&e.octave===a.octave));t.push(a)}w(t),y(Array(f).fill(""))},0))},Y=e=>{let t=(("treble"===D?4:2)-e.octave)*7;return({treble:{C:10,D:9,E:8,F:7,G:6,A:5,B:4},bass:{G:8,A:7,B:6,C:5,D:4,E:3,F:2,G:1,A:0}})[D][e.name]+t},Z=e=>{let t=Y(e),a=[];if("treble"===D){if(t>=10)for(let e=10;e<=t;e+=2)a.push({position:e});else if(t<=0)for(let e=0;e>=t;e-=2)a.push({position:e})}else if(t>=10)for(let e=10;e<=t;e+=2)a.push({position:e});else if(t<=-2)for(let e=-2;e>=t;e-=2)a.push({position:e});return a},$=e=>"".concat(e.name).concat(e.octave);return(0,n.useEffect)(()=>{let e=e=>{let t=e.key.toUpperCase();r.includes(t)&&Q(t),"Space"===e.code&&(e.preventDefault(),J())};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[j,v,M,A,T]),(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen p-4",children:[(0,l.jsx)("div",{className:"w-full max-w-md flex justify-end mb-2",children:(0,l.jsxs)("select",{value:e,onChange:e=>t(e.target.value),className:"px-2 py-1 border rounded",children:[(0,l.jsx)("option",{value:"en",children:"English"}),(0,l.jsx)("option",{value:"ja",children:"日本語"})]})}),(0,l.jsx)("h1",{className:"text-3xl font-bold mb-8",children:s("title")}),(0,l.jsxs)("div",{className:"w-full max-w-md mb-4 flex",children:[(0,l.jsx)("button",{className:"flex-1 py-2 px-4 ".concat("treble"===D?"bg-blue-500 text-white":"bg-gray-200"),onClick:()=>W("treble"),children:s("trebleClef")}),(0,l.jsx)("button",{className:"flex-1 py-2 px-4 ".concat("bass"===D?"bg-blue-500 text-white":"bg-gray-200"),onClick:()=>W("bass"),children:s("bassClef")})]}),(0,l.jsx)("div",{className:"w-full max-w-md mb-4 flex justify-end",children:(0,l.jsx)("button",{className:"py-1 px-3 bg-gray-200 text-sm rounded",onClick:()=>h(!b),children:b?s("closeRangeSettings"):s("rangeSettings")})}),b&&(0,l.jsxs)("div",{className:"w-full max-w-md mb-4 p-4 border rounded-lg bg-gray-50",children:[(0,l.jsxs)("h3",{className:"font-bold mb-2",children:[s("rangeSettings")," (","treble"===D?s("trebleClef"):s("bassClef"),")"]}),(0,l.jsxs)("div",{className:"flex items-center mb-3",children:[(0,l.jsxs)("label",{className:"w-24",children:[s("lowerLimit"),":"]}),(0,l.jsx)("input",{type:"text",value:m[D],onChange:e=>u({...m,[D]:e.target.value}),className:"border px-2 py-1 w-16",placeholder:"C4"}),(0,l.jsx)("span",{className:"mx-2",children:"-"}),(0,l.jsxs)("label",{className:"w-24",children:[s("upperLimit"),":"]}),(0,l.jsx)("input",{type:"text",value:d[D],onChange:e=>x({...d,[D]:e.target.value}),className:"border px-2 py-1 w-16",placeholder:"C6"})]}),(0,l.jsx)("div",{className:"text-sm text-gray-600 mb-3",children:s("example")}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,l.jsx)("button",{className:"py-1 px-3 bg-gray-300 text-sm rounded",onClick:()=>{i(e=>({...e,[D]:c[D]})),u(e=>({...e,[D]:U(c[D].min)})),x(e=>({...e,[D]:U(c[D].max)})),h(!1),z()},children:s("resetToDefault")}),(0,l.jsx)("button",{className:"py-1 px-3 bg-blue-500 text-white text-sm rounded",onClick:()=>{let t=I(m[D]),a=I(d[D]);if(!t||!a){alert("en"===e?"Invalid note range. Example: C4, F5, etc.":"無効な音符範囲です。例：C4, F5 など");return}if(X(t,a)>0){alert("en"===e?"Lower limit is higher than upper limit":"下限の音符が上限より高くなっています");return}i(e=>({...e,[D]:{min:t,max:a}})),h(!1),z()},children:s("apply")})]})]}),(0,l.jsxs)("div",{className:"w-full max-w-md mb-4 p-4 border rounded-lg bg-gray-50",children:[(0,l.jsx)("h3",{className:"font-bold mb-2",children:s("noteCount")}),(0,l.jsx)("div",{className:"flex justify-between",children:[1,2,3,4,5,6,7,8].map(e=>(0,l.jsx)("button",{className:"w-8 h-8 rounded-full ".concat(f===e?"bg-blue-500 text-white":"bg-gray-200"),onClick:()=>V(e),children:e},e))})]}),(0,l.jsx)("div",{className:"w-full max-w-md p-6 mb-8 border rounded-lg shadow-md",children:(0,l.jsxs)("div",{className:"flex flex-col items-center",children:[(0,l.jsxs)("div",{className:"text-sm text-gray-600 mb-2 self-start",children:[s("currentRange"),": ",U(o[D].min)," -"," ",U(o[D].max)]}),(0,l.jsx)("div",{className:"text-sm text-gray-600 mb-2 self-start",children:s("currentNote",{current:v+1,total:f})}),(0,l.jsxs)("div",{className:"relative w-full h-[180px] mb-8",children:[[0,1,2,3,4].map(e=>(0,l.jsx)("div",{className:"absolute w-full h-[2px] bg-black",style:{top:"".concat(12*e+60,"px")}},e)),j.length>0&&j.map((e,t)=>{let a=Math.min(40,(400-24*j.length)/(j.length+1)),n=t*(24+a)+a+12,s=t===v;return(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"absolute w-[24px] h-[12px] rounded-full transition-all duration-200 ".concat(s?"bg-blue-500":"bg-black"),style:{top:"".concat(6*Y(e)+54,"px"),left:"".concat(n,"px"),transform:"translateX(-50%)"}}),Z(e).map((e,a)=>(0,l.jsx)("div",{className:"absolute w-[40px] h-[2px] bg-black",style:{top:"".concat(6*e.position+60,"px"),left:"".concat(n,"px"),transform:"translateX(-50%)"}},"ledger-".concat(t,"-").concat(a))),C[t]&&t<v&&(0,l.jsx)("div",{className:"absolute text-xs font-bold ".concat(C[t]===e.name?"text-green-500":"text-red-500"),style:{top:"".concat(6*Y(e)+72,"px"),left:"".concat(n,"px"),transform:"translateX(-50%)"},children:C[t]})]},t)})]}),(0,l.jsx)("div",{className:"min-h-[32px] text-center mb-4",children:E&&(0,l.jsx)("p",{className:E.includes("Correct")||E.includes("正解")?"text-green-500":"text-red-500",children:E})}),(0,l.jsx)("div",{className:"grid grid-cols-7 gap-2 w-full mb-6",children:r.map(e=>(0,l.jsx)("button",{className:"py-2 border rounded ".concat(C[v]===e?"bg-blue-500 text-white":"bg-white"),onClick:()=>Q(e),disabled:T,children:e},e))}),(0,l.jsx)("div",{className:"text-sm text-gray-600 mb-4 text-center",children:(0,l.jsx)("p",{children:s("keyboardShortcuts")})}),(0,l.jsx)("div",{className:"text-center mb-4",children:(0,l.jsxs)("p",{children:[s("score"),": ",M," / ",A]})}),(0,l.jsx)("button",{onClick:J,className:"w-full py-2 bg-blue-500 text-white rounded",children:s("nextNote")})]})})]})}},7238:(e,t,a)=>{Promise.resolve().then(a.bind(a,1057))}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,358],()=>t(7238)),_N_E=e.O()}]);